# This is a sample build configuration for Javascript (Node.js).
# Check our guides at https://confluence.atlassian.com/x/14UWN for more examples.
# Only use spaces to indent your .yml configuration.
# -----
# You can specify a custom docker image from Docker Hub as your build environment.
image: node:7.4.0

pipelines:
  default: # Pipelines that run automatically on a commit to a branch
    - step:
        script: # Modify the commands below to build your repository.
          - npm install
          - npm run test
          - npm run build
          - npm run setKarmaGlobals -- --browser PhantomJS
          - npm run test/phantomjs --silent
  branches:
    dev:
      - step:
          script:
            - npm install
            - npm run build
            - curl -X POST --data-urlencode 'payload={"channel": "#deployments", "username": "Frankie", "text": "Deploying ....", "icon_emoji": ":shipit:"}'  https://hooks.slack.com/services/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
            - npm run deploy
            - SHA=$(git rev-parse --verify HEAD)
            - SHA="https://bitbucket.org/Tonio31/program_2_0/commits/$SHA deployed to http://test-program.potentialife.com"
            - curl -X POST --data-urlencode 'payload={"channel": "#deployments", "username": "Frankie", "text": "'"$SHA"'", "icon_emoji": ":shipit:"}'  https://hooks.slack.com/services/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
